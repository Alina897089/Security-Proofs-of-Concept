## 3. Security PoC: Critical Vulnerability - Unauthenticated Price Manipulation in Admin Panel

### Overview
During an exploratory check (outside the original scope of work), a critical vulnerability was discovered in the admin panel. An unauthenticated PATCH endpoint allowed unauthorized manipulation of product prices without any authentication credentials (e.g., cookies or tokens).

| Metric | Value | Rationale |
| :--- | :--- | :--- |
| **Severity** | **Critical** | Leads directly to financial fraud, massive unauthenticated data modification (price manipulation), and potential severe reputational damage. |
| **CWE** | **CWE-306** | Missing Authentication for Critical Function. The system allows direct access to a high-impact modification endpoint without verifying the user's identity. |
| **Risk Rating** | **Critical** | The vulnerability could be easily exploited by any external attacker to cause immediate, quantifiable financial loss. |

### Impact
This vulnerability could lead to **significant financial losses and severe reputational damage**. An attacker could set product prices to arbitrarily low values (e.g., `1 RUB`) and potentially use automated scripts to mass-purchase goods at the manipulated price before internal systems (like 1C synchronization) can update, effectively committing financial fraud.

### Affected System
•   **System Type:** Corporate admin panel / E-commerce backend

•   **Sample Endpoint/URL:** `https://[anonymized-corporate-website.com]/admin/api/products/{product_id}/price`

### Steps to Reproduce
1.  Ensure no authentication tokens or cookies are sent with the request (e.g., by clearing cookies in Postman or browser developer tools).
2.  Identify the API endpoint responsible for updating product prices (e.g., `/admin/api/products/123/price`).
3.  Send an HTTP-PATCH request to this endpoint.
4.  In the request body, set the price of a product to a desired low value (e.g., `{"price": 1, "currency": "RUB"}`).
5.  Observe the successful price update in the system without requiring any authentication.
6.  *(Optional exploit scenario)*: Use an automated script to rapidly mass-purchase the goods at the manipulated price before system synchronization (within 5 minutes) to demonstrate the full financial impact.

### Risk & Confirmation
The vulnerability carried a high risk of significant financial losses and reputational damage. After reporting the issue in the team chat, the product manager and backend developer confirmed its criticality and prioritized an immediate fix. A task for this fix was promptly created in the tracker.

### Proof of Concept
![69b6b38b-ce59-4449-9538-2b997d849e50](https://github.com/user-attachments/assets/50b4212b-6529-4b02-a3ce-9e42d0bf3a11)
<img width="1568" height="877" alt="chrome_ljRPrpvxHg2025" src="https://github.com/user-attachments/assets/4cc221a6-89b0-43cc-8536-2f02daa74628" />

### Tools Used
•   Postman

### Recommended Remediation
To mitigate this critical security failure, the following security controls must be immediately implemented:

1.  **Strict Authentication Check:** Implement mandatory authentication for **all** endpoints under the `/admin/api/` path. Reject any request that does not contain a valid, authenticated session token or cookie.
2.  **Authorization (Role Check):** Beyond authentication, implement robust **Role-Based Access Control (RBAC)** to ensure that only users with the specific role (`Admin`, `Price Manager`) can execute the `PATCH` (write/modify) operation on product prices.
3.  **Input Validation (Sanity Check):** Implement server-side business logic validation to prevent prices from being set below a reasonable minimum threshold (e.g., prices cannot be less than 50 RUB).
